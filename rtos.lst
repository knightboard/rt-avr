   1               	# 1 "rtos.s"
   1               	
   0               	
   0               	
   2               	/* 
   3               	EEPROMRead:
   4               	ERL01:	sbic	EECR, EEWE	;if EEWE not clear
   5               			rjmp	ERL01		; wait more 
   6               	
   7               			out		EEARH, ZH	;output address 
   8               			out		EEARL, ZL	;output address 
   9               	
  10               			sbi		EECR, EERE	;set EEPROM Read strobe
  11               			in		OSRG, EEDR	;get data
  12               			ret
  13               		
  14               	EEPROMWrite:
  15               	EWL01:	sbic	EECR, EEWE	;if EEWE not clear
  16               			rjmp	EWL01		;    wait more
  17               		
  18               			out		EEARH, ZH	
  19               			out		EEARL, ZL	
  20               	
  21               			out		EEDR, OSRG	;output data
  22               			sbi		EECR, EEMWE	;set EEPROM Master Write Enable
  23               			sbi		EECR, EEWE	;set EEPROM Write strobe
  24               			ret
  25               	*/
  26               	.include "avr.inc"
   1               	# 1 "avr.inc.h"
   1               	#include <avr/io.h>
   1               	/* Copyright (c) 2002,2003,2005,2006,2007 Marek Michalkiewicz, Joerg Wunsch
   2               	   Copyright (c) 2007 Eric B. Weddington
   3               	   All rights reserved.
   4               	
   5               	   Redistribution and use in source and binary forms, with or without
   6               	   modification, are permitted provided that the following conditions are met:
   7               	
   8               	   * Redistributions of source code must retain the above copyright
   9               	     notice, this list of conditions and the following disclaimer.
  10               	
  11               	   * Redistributions in binary form must reproduce the above copyright
  12               	     notice, this list of conditions and the following disclaimer in
  13               	     the documentation and/or other materials provided with the
  14               	     distribution.
  15               	
  16               	   * Neither the name of the copyright holders nor the names of
  17               	     contributors may be used to endorse or promote products derived
  18               	     from this software without specific prior written permission.
  19               	
  20               	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  21               	  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  22               	  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  23               	  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  24               	  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  25               	  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  26               	  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  27               	  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  28               	  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  29               	  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  30               	  POSSIBILITY OF SUCH DAMAGE. */
  31               	
  32               	/* $Id$ */
  33               	
  34               	/** \file */
  35               	/** \defgroup avr_io <avr/io.h>: AVR device-specific IO definitions
  36               	    \code #include <avr/io.h> \endcode
  37               	
  38               	    This header file includes the apropriate IO definitions for the
  39               	    device that has been specified by the <tt>-mmcu=</tt> compiler
  40               	    command-line switch.  This is done by diverting to the appropriate
  41               	    file <tt>&lt;avr/io</tt><em>XXXX</em><tt>.h&gt;</tt> which should
  42               	    never be included directly.  Some register names common to all
  43               	    AVR devices are defined directly within <tt>&lt;avr/common.h&gt;</tt>,
  44               	    which is included in <tt>&lt;avr/io.h&gt;</tt>,
  45               	    but most of the details come from the respective include file.
  46               	
  47               	    Note that this file always includes the following files:
  48               	    \code 
  49               	    #include <avr/sfr_defs.h>
  50               	    #include <avr/portpins.h>
  51               	    #include <avr/common.h>
  52               	    #include <avr/version.h>
  53               	    \endcode
  54               	    See \ref avr_sfr for more details about that header file.
  55               	
  56               	    Included are definitions of the IO register set and their
  57               	    respective bit values as specified in the Atmel documentation.
  58               	    Note that inconsistencies in naming conventions,
  59               	    so even identical functions sometimes get different names on
  60               	    different devices.
  61               	
  62               	    Also included are the specific names useable for interrupt
  63               	    function definitions as documented
  64               	    \ref avr_signames "here".
  65               	
  66               	    Finally, the following macros are defined:
  67               	
  68               	    - \b RAMEND
  69               	    <br>
  70               	    The last on-chip RAM address.
  71               	    <br>
  72               	    - \b XRAMEND
  73               	    <br>
  74               	    The last possible RAM location that is addressable. This is equal to 
  75               	    RAMEND for devices that do not allow for external RAM. For devices 
  76               	    that allow external RAM, this will be larger than RAMEND.
  77               	    <br>
  78               	    - \b E2END
  79               	    <br>
  80               	    The last EEPROM address.
  81               	    <br>
  82               	    - \b FLASHEND
  83               	    <br>
  84               	    The last byte address in the Flash program space.
  85               	    <br>
  86               	    - \b SPM_PAGESIZE
  87               	    <br>
  88               	    For devices with bootloader support, the flash pagesize
  89               	    (in bytes) to be used for the \c SPM instruction. 
  90               	    - \b E2PAGESIZE
  91               	    <br>
  92               	    The size of the EEPROM page.
  93               	    
  94               	*/
  95               	
  96               	#ifndef _AVR_IO_H_
  97               	#define _AVR_IO_H_
  98               	
  99               	#include <avr/sfr_defs.h>
   1               	/* Copyright (c) 2002, Marek Michalkiewicz <marekm@amelek.gda.pl>
 100               	
 101               	#if defined (__AVR_AT94K__)
 102               	#  include <avr/ioat94k.h>
 103               	#elif defined (__AVR_AT43USB320__)
 104               	#  include <avr/io43u32x.h>
 105               	#elif defined (__AVR_AT43USB355__)
 106               	#  include <avr/io43u35x.h>
 107               	#elif defined (__AVR_AT76C711__)
 108               	#  include <avr/io76c711.h>
 109               	#elif defined (__AVR_AT86RF401__)
 110               	#  include <avr/io86r401.h>
 111               	#elif defined (__AVR_AT90PWM1__)
 112               	#  include <avr/io90pwm1.h>
 113               	#elif defined (__AVR_AT90PWM2__)
 114               	#  include <avr/io90pwmx.h>
 115               	#elif defined (__AVR_AT90PWM2B__)
 116               	#  include <avr/io90pwm2b.h>
 117               	#elif defined (__AVR_AT90PWM3__)
 118               	#  include <avr/io90pwmx.h>
 119               	#elif defined (__AVR_AT90PWM3B__)
 120               	#  include <avr/io90pwm3b.h>
 121               	#elif defined (__AVR_AT90PWM216__)
 122               	#  include <avr/io90pwm216.h>
 123               	#elif defined (__AVR_AT90PWM316__)
 124               	#  include <avr/io90pwm316.h>
 125               	#elif defined (__AVR_AT90PWM161__)
 126               	#  include <avr/io90pwm161.h>
 127               	#elif defined (__AVR_AT90PWM81__)
 128               	#  include <avr/io90pwm81.h>
 129               	#elif defined (__AVR_ATmega8U2__)
 130               	#  include <avr/iom8u2.h>
 131               	#elif defined (__AVR_ATmega16M1__)
 132               	#  include <avr/iom16m1.h>
 133               	#elif defined (__AVR_ATmega16U2__)
 134               	#  include <avr/iom16u2.h>
 135               	#elif defined (__AVR_ATmega16U4__)
 136               	#  include <avr/iom16u4.h>
 137               	#elif defined (__AVR_ATmega32C1__)
 138               	#  include <avr/iom32c1.h>
 139               	#elif defined (__AVR_ATmega32M1__)
 140               	#  include <avr/iom32m1.h>
 141               	#elif defined (__AVR_ATmega32U2__)
 142               	#  include <avr/iom32u2.h>
 143               	#elif defined (__AVR_ATmega32U4__)
 144               	#  include <avr/iom32u4.h>
 145               	#elif defined (__AVR_ATmega32U6__)
 146               	#  include <avr/iom32u6.h>
 147               	#elif defined (__AVR_ATmega64C1__)
 148               	#  include <avr/iom64c1.h>
 149               	#elif defined (__AVR_ATmega64M1__)
 150               	#  include <avr/iom64m1.h>
 151               	#elif defined (__AVR_ATmega128__)
 152               	#  include <avr/iom128.h>
 153               	#elif defined (__AVR_ATmega128A__)
 154               	#  include <avr/iom128a.h>
 155               	#elif defined (__AVR_ATmega1280__)
 156               	#  include <avr/iom1280.h>
 157               	#elif defined (__AVR_ATmega1281__)
 158               	#  include <avr/iom1281.h>
 159               	#elif defined (__AVR_ATmega1284__)
 160               	#  include <avr/iom1284.h>
 161               	#elif defined (__AVR_ATmega1284P__)
 162               	#  include <avr/iom1284p.h>
 163               	#elif defined (__AVR_ATmega128RFA1__)
 164               	#  include <avr/iom128rfa1.h>
 165               	#elif defined (__AVR_ATmega128RFR2__)
 166               	#  include <avr/iom128rfr2.h>
 167               	#elif defined (__AVR_ATmega1284RFR2__)
 168               	#  include <avr/iom1284rfr2.h>
 169               	#elif defined (__AVR_ATmega256RFR2__)
 170               	#  include <avr/iom256rfr2.h>
 171               	#elif defined (__AVR_ATmega2564RFR2__)
 172               	#  include <avr/iom2564rfr2.h>
 173               	#elif defined (__AVR_ATmega2560__)
 174               	#  include <avr/iom2560.h>
 175               	#elif defined (__AVR_ATmega2561__)
 176               	#  include <avr/iom2561.h>
 177               	#elif defined (__AVR_AT90CAN32__)
 178               	#  include <avr/iocan32.h>
 179               	#elif defined (__AVR_AT90CAN64__)
 180               	#  include <avr/iocan64.h>
 181               	#elif defined (__AVR_AT90CAN128__)
 182               	#  include <avr/iocan128.h>
 183               	#elif defined (__AVR_AT90USB82__)
 184               	#  include <avr/iousb82.h>
 185               	#elif defined (__AVR_AT90USB162__)
 186               	#  include <avr/iousb162.h>
 187               	#elif defined (__AVR_AT90USB646__)
 188               	#  include <avr/iousb646.h>
 189               	#elif defined (__AVR_AT90USB647__)
 190               	#  include <avr/iousb647.h>
 191               	#elif defined (__AVR_AT90USB1286__)
 192               	#  include <avr/iousb1286.h>
 193               	#elif defined (__AVR_AT90USB1287__)
 194               	#  include <avr/iousb1287.h>
 195               	#elif defined (__AVR_ATmega64RFR2__)
 196               	#  include <avr/iom64rfr2.h>
 197               	#elif defined (__AVR_ATmega644RFR2__)
 198               	#  include <avr/iom644rfr2.h>
 199               	#elif defined (__AVR_ATmega64__)
 200               	#  include <avr/iom64.h>
 201               	#elif defined (__AVR_ATmega64A__)
 202               	#  include <avr/iom64a.h>
 203               	#elif defined (__AVR_ATmega640__)
 204               	#  include <avr/iom640.h>
 205               	#elif defined (__AVR_ATmega644__) 
 206               	#  include <avr/iom644.h>
 207               	#elif (defined __AVR_ATmega644A__)
 208               	#include <avr/iom644a.h>
 209               	#elif defined (__AVR_ATmega644P__)
 210               	#  include <avr/iom644p.h>
 211               	#elif defined (__AVR_ATmega644PA__)
 212               	#  include <avr/iom644pa.h>
 213               	#elif defined (__AVR_ATmega645__)
 214               	#  include <avr/iom645.h>
 215               	#elif (defined __AVR_ATmega645A__)
 216               	#include <avr/iom645a.h>
 217               	#elif (defined __AVR_ATmega645P__)
 218               	#include <avr/iom645p.h>
 219               	#elif defined (__AVR_ATmega6450__)
 220               	#  include <avr/iom6450.h>
 221               	#elif (defined __AVR_ATmega6450A__)
 222               	#include <avr/iom6450a.h>
 223               	#elif (defined __AVR_ATmega6450P__)
 224               	#include <avr/iom6450p.h>
 225               	#elif defined (__AVR_ATmega649__)
 226               	#  include <avr/iom649.h>
 227               	#elif (defined __AVR_ATmega649A__)
 228               	#include <avr/iom649a.h>
 229               	#elif defined (__AVR_ATmega6490__)
 230               	#  include <avr/iom6490.h>
 231               	#elif (defined __AVR_ATmega6490A__)
 232               	#include <avr/iom6490a.h>
 233               	#elif (defined __AVR_ATmega6490P__)
 234               	#include <avr/iom6490p.h>
 235               	#elif defined (__AVR_ATmega649P__)
 236               	#  include <avr/iom649p.h>
 237               	#elif defined (__AVR_ATmega64HVE__)
 238               	#  include <avr/iom64hve.h>
 239               	#elif defined (__AVR_ATmega64HVE2__)
 240               	#  include <avr/iom64hve2.h>
 241               	#elif defined (__AVR_ATmega103__)
 242               	#  include <avr/iom103.h>
 243               	#elif defined (__AVR_ATmega32__)
 244               	#  include <avr/iom32.h>
   1               	/* Copyright (c) 2002, Steinar Haugen
   2               	   All rights reserved.
   3               	
   4               	   Redistribution and use in source and binary forms, with or without
   5               	   modification, are permitted provided that the following conditions are met:
   6               	
   7               	   * Redistributions of source code must retain the above copyright
   8               	     notice, this list of conditions and the following disclaimer.
   9               	
  10               	   * Redistributions in binary form must reproduce the above copyright
  11               	     notice, this list of conditions and the following disclaimer in
  12               	     the documentation and/or other materials provided with the
  13               	     distribution.
  14               	
  15               	   * Neither the name of the copyright holders nor the names of
  16               	     contributors may be used to endorse or promote products derived
  17               	     from this software without specific prior written permission.
  18               	
  19               	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  20               	  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  21               	  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  22               	  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  23               	  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  24               	  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  25               	  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  26               	  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  27               	  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  28               	  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  29               	  POSSIBILITY OF SUCH DAMAGE. */
  30               	
  31               	/* $Id: iom32.h 2233 2011-03-15 15:49:50Z arcanum $ */
  32               	
  33               	/* avr/iom32.h - definitions for ATmega32 */
  34               	
  35               	#ifndef _AVR_IOM32_H_
  36               	#define _AVR_IOM32_H_ 1
  37               	
  38               	/* This file should only be included from <avr/io.h>, never directly. */
  39               	
  40               	#ifndef _AVR_IO_H_
  41               	#  error "Include <avr/io.h> instead of this file."
  42               	#endif
  43               	
  44               	#ifndef _AVR_IOXXX_H_
  45               	#  define _AVR_IOXXX_H_ "iom32.h"
  46               	#else
  47               	#  error "Attempt to include more than one <avr/ioXXX.h> file."
  48               	#endif 
  49               	
  50               	/* I/O registers */
  51               	
  52               	/* TWI stands for "Two Wire Interface" or "TWI Was I2C(tm)" */
  53               	#define TWBR    _SFR_IO8(0x00)
  54               	#define TWSR    _SFR_IO8(0x01)
  55               	#define TWAR    _SFR_IO8(0x02)
  56               	#define TWDR    _SFR_IO8(0x03)
  57               	
  58               	/* ADC */
  59               	#ifndef __ASSEMBLER__
  60               	#define ADC     _SFR_IO16(0x04)
  61               	#endif
  62               	#define ADCW    _SFR_IO16(0x04)
  63               	#define ADCL    _SFR_IO8(0x04)
  64               	#define ADCH    _SFR_IO8(0x05)
  65               	#define ADCSRA  _SFR_IO8(0x06)
  66               	#define ADMUX   _SFR_IO8(0x07)
  67               	
  68               	/* analog comparator */
  69               	#define ACSR    _SFR_IO8(0x08)
  70               	
  71               	/* USART */
  72               	#define UBRRL   _SFR_IO8(0x09)
  73               	#define UCSRB   _SFR_IO8(0x0A)
  74               	#define UCSRA   _SFR_IO8(0x0B)
  75               	#define UDR     _SFR_IO8(0x0C)
  76               	
  77               	/* SPI */
  78               	#define SPCR    _SFR_IO8(0x0D)
  79               	#define SPSR    _SFR_IO8(0x0E)
  80               	#define SPDR    _SFR_IO8(0x0F)
  81               	
  82               	/* Port D */
  83               	#define PIND    _SFR_IO8(0x10)
  84               	#define DDRD    _SFR_IO8(0x11)
  85               	#define PORTD   _SFR_IO8(0x12)
  86               	
  87               	/* Port C */
  88               	#define PINC    _SFR_IO8(0x13)
  89               	#define DDRC    _SFR_IO8(0x14)
  90               	#define PORTC   _SFR_IO8(0x15)
  91               	
  92               	/* Port B */
  93               	#define PINB    _SFR_IO8(0x16)
  94               	#define DDRB    _SFR_IO8(0x17)
  95               	#define PORTB   _SFR_IO8(0x18)
  96               	
  97               	/* Port A */
  98               	#define PINA    _SFR_IO8(0x19)
  99               	#define DDRA    _SFR_IO8(0x1A)
 100               	#define PORTA   _SFR_IO8(0x1B)
 101               	
 102               	/* EEPROM Control Register */
 103               	#define EECR	_SFR_IO8(0x1C)
 104               	
 105               	/* EEPROM Data Register */
 106               	#define EEDR	_SFR_IO8(0x1D)
 107               	
 108               	/* EEPROM Address Register */
 109               	#define EEAR	_SFR_IO16(0x1E)
 110               	#define EEARL	_SFR_IO8(0x1E)
 111               	#define EEARH	_SFR_IO8(0x1F)
 112               	
 113               	#define UBRRH   _SFR_IO8(0x20)
 114               	#define UCSRC   UBRRH
 115               	
 116               	#define WDTCR   _SFR_IO8(0x21)
 117               	
 118               	#define ASSR    _SFR_IO8(0x22)
 119               	
 120               	/* Timer 2 */
 121               	#define OCR2    _SFR_IO8(0x23)
 122               	#define TCNT2   _SFR_IO8(0x24)
 123               	#define TCCR2   _SFR_IO8(0x25)
 124               	
 125               	/* Timer 1 */
 126               	#define ICR1    _SFR_IO16(0x26)
 127               	#define ICR1L   _SFR_IO8(0x26)
 128               	#define ICR1H   _SFR_IO8(0x27)
 129               	#define OCR1B   _SFR_IO16(0x28)
 130               	#define OCR1BL  _SFR_IO8(0x28)
 131               	#define OCR1BH  _SFR_IO8(0x29)
 132               	#define OCR1A   _SFR_IO16(0x2A)
 133               	#define OCR1AL  _SFR_IO8(0x2A)
 134               	#define OCR1AH  _SFR_IO8(0x2B)
 135               	#define TCNT1   _SFR_IO16(0x2C)
 136               	#define TCNT1L  _SFR_IO8(0x2C)
 137               	#define TCNT1H  _SFR_IO8(0x2D)
 138               	#define TCCR1B  _SFR_IO8(0x2E)
 139               	#define TCCR1A  _SFR_IO8(0x2F)
 140               	
 141               	#define SFIOR   _SFR_IO8(0x30)
 142               	
 143               	#define OSCCAL  _SFR_IO8(0x31)
 144               	#define OCDR    OSCCAL
 145               	
 146               	/* Timer 0 */
 147               	#define TCNT0   _SFR_IO8(0x32)
 148               	#define TCCR0   _SFR_IO8(0x33)
 149               	
 150               	#define MCUSR   _SFR_IO8(0x34)
 151               	#define MCUCSR  MCUSR
 152               	#define MCUCR   _SFR_IO8(0x35)
 153               	
 154               	#define TWCR    _SFR_IO8(0x36)
 155               	
 156               	#define SPMCR   _SFR_IO8(0x37)
 157               	
 158               	#define TIFR    _SFR_IO8(0x38)
 159               	#define TIMSK   _SFR_IO8(0x39)
 160               	
 161               	#define GIFR    _SFR_IO8(0x3A)
 162               	#define GIMSK   _SFR_IO8(0x3B)
 163               	#define GICR    GIMSK
 164               	
 165               	#define OCR0    _SFR_IO8(0x3C)
 166               	
 167               	/* 0x3D..0x3E SP */
 168               	
 169               	/* 0x3F SREG */
 170               	
 171               	/* Interrupt vectors */
 172               	
 173               	/* External Interrupt Request 0 */
 174               	#define INT0_vect_num		1
 175               	#define INT0_vect			_VECTOR(1)
 176               	#define SIG_INTERRUPT0			_VECTOR(1)
 177               	
 178               	/* External Interrupt Request 1 */
 179               	#define INT1_vect_num		2
 180               	#define INT1_vect			_VECTOR(2)
 181               	#define SIG_INTERRUPT1			_VECTOR(2)
 182               	
 183               	/* External Interrupt Request 2 */
 184               	#define INT2_vect_num		3
 185               	#define INT2_vect			_VECTOR(3)
 186               	#define SIG_INTERRUPT2			_VECTOR(3)
 187               	
 188               	/* Timer/Counter2 Compare Match */
 189               	#define TIMER2_COMP_vect_num	4
 190               	#define TIMER2_COMP_vect		_VECTOR(4)
 191               	#define SIG_OUTPUT_COMPARE2		_VECTOR(4)
 192               	
 193               	/* Timer/Counter2 Overflow */
 194               	#define TIMER2_OVF_vect_num		5
 195               	#define TIMER2_OVF_vect			_VECTOR(5)
 196               	#define SIG_OVERFLOW2			_VECTOR(5)
 197               	
 198               	/* Timer/Counter1 Capture Event */
 199               	#define TIMER1_CAPT_vect_num	6
 200               	#define TIMER1_CAPT_vect		_VECTOR(6)
 201               	#define SIG_INPUT_CAPTURE1		_VECTOR(6)
 202               	
 203               	/* Timer/Counter1 Compare Match A */
 204               	#define TIMER1_COMPA_vect_num	7
 205               	#define TIMER1_COMPA_vect		_VECTOR(7)
 206               	#define SIG_OUTPUT_COMPARE1A		_VECTOR(7)
 207               	
 208               	/* Timer/Counter1 Compare Match B */
 209               	#define TIMER1_COMPB_vect_num	8
 210               	#define TIMER1_COMPB_vect		_VECTOR(8)
 211               	#define SIG_OUTPUT_COMPARE1B		_VECTOR(8)
 212               	
 213               	/* Timer/Counter1 Overflow */
 214               	#define TIMER1_OVF_vect_num		9
 215               	#define TIMER1_OVF_vect			_VECTOR(9)
 216               	#define SIG_OVERFLOW1			_VECTOR(9)
 217               	
 218               	/* Timer/Counter0 Compare Match */
 219               	#define TIMER0_COMP_vect_num	10
 220               	#define TIMER0_COMP_vect		_VECTOR(10)
 221               	#define SIG_OUTPUT_COMPARE0		_VECTOR(10)
 222               	
 223               	/* Timer/Counter0 Overflow */
 224               	#define TIMER0_OVF_vect_num		11
 225               	#define TIMER0_OVF_vect			_VECTOR(11)
 226               	#define SIG_OVERFLOW0			_VECTOR(11)
 227               	
 228               	/* Serial Transfer Complete */
 229               	#define SPI_STC_vect_num		12
 230               	#define SPI_STC_vect			_VECTOR(12)
 231               	#define SIG_SPI				_VECTOR(12)
 232               	
 233               	/* USART, Rx Complete */
 234               	#define USART_RXC_vect_num		13
 235               	#define USART_RXC_vect			_VECTOR(13)
 236               	#define SIG_USART_RECV			_VECTOR(13)
 237               	#define SIG_UART_RECV			_VECTOR(13)
 238               	
 239               	/* USART Data Register Empty */
 240               	#define USART_UDRE_vect_num		14
 241               	#define USART_UDRE_vect			_VECTOR(14)
 242               	#define SIG_USART_DATA			_VECTOR(14)
 243               	#define SIG_UART_DATA			_VECTOR(14)
 244               	
 245               	/* USART, Tx Complete */
 246               	#define USART_TXC_vect_num		15
 247               	#define USART_TXC_vect			_VECTOR(15)
 248               	#define SIG_USART_TRANS			_VECTOR(15)
 249               	#define SIG_UART_TRANS			_VECTOR(15)
 250               	
 251               	/* ADC Conversion Complete */
 252               	#define ADC_vect_num		16
 253               	#define ADC_vect			_VECTOR(16)
 254               	#define SIG_ADC				_VECTOR(16)
 255               	
 256               	/* EEPROM Ready */
 257               	#define EE_RDY_vect_num		17
 258               	#define EE_RDY_vect			_VECTOR(17)
 259               	#define SIG_EEPROM_READY		_VECTOR(17)
 260               	
 261               	/* Analog Comparator */
 262               	#define ANA_COMP_vect_num		18
 263               	#define ANA_COMP_vect			_VECTOR(18)
 264               	#define SIG_COMPARATOR			_VECTOR(18)
 265               	
 266               	/* 2-wire Serial Interface */
 267               	#define TWI_vect_num		19
 268               	#define TWI_vect			_VECTOR(19)
 269               	#define SIG_2WIRE_SERIAL		_VECTOR(19)
 270               	
 271               	/* Store Program Memory Ready */
 272               	#define SPM_RDY_vect_num		20
 273               	#define SPM_RDY_vect			_VECTOR(20)
 274               	#define SIG_SPM_READY			_VECTOR(20)
 275               	
 276               	#define _VECTORS_SIZE 84
 277               	
 278               	/* Bit numbers */
 279               	
 280               	/* GICR */
 281               	#define INT1    7
 282               	#define INT0    6
 283               	#define INT2    5
 284               	#define IVSEL   1
 285               	#define IVCE    0
 286               	
 287               	/* GIFR */
 288               	#define INTF1   7
 289               	#define INTF0   6
 290               	#define INTF2   5
 291               	
 292               	/* TIMSK */
 293               	#define OCIE2   7
 294               	#define TOIE2   6
 295               	#define TICIE1  5
 296               	#define OCIE1A  4
 297               	#define OCIE1B  3
 298               	#define TOIE1   2
 299               	#define OCIE0   1
 300               	#define TOIE0   0
 301               	
 302               	/* TIFR */
 303               	#define OCF2    7
 304               	#define TOV2    6
 305               	#define ICF1    5
 306               	#define OCF1A   4
 307               	#define OCF1B   3
 308               	#define TOV1    2
 309               	#define OCF0    1
 310               	#define TOV0    0
 311               	
 312               	/* SPMCR */
 313               	#define SPMIE   7
 314               	#define RWWSB   6
 315               	/* bit 5 reserved */
 316               	#define RWWSRE  4
 317               	#define BLBSET  3
 318               	#define PGWRT   2
 319               	#define PGERS   1
 320               	#define SPMEN   0
 321               	
 322               	/* TWCR */
 323               	#define TWINT   7
 324               	#define TWEA    6
 325               	#define TWSTA   5
 326               	#define TWSTO   4
 327               	#define TWWC    3
 328               	#define TWEN    2
 329               	/* bit 1 reserved */
 330               	#define TWIE    0
 331               	
 332               	/* TWAR */
 333               	#define TWA6    7
 334               	#define TWA5    6
 335               	#define TWA4    5
 336               	#define TWA3    4
 337               	#define TWA2    3
 338               	#define TWA1    2
 339               	#define TWA0    1
 340               	#define TWGCE   0
 341               	
 342               	/* TWSR */
 343               	#define TWS7    7
 344               	#define TWS6    6
 345               	#define TWS5    5
 346               	#define TWS4    4
 347               	#define TWS3    3
 348               	/* bit 2 reserved */
 349               	#define TWPS1   1
 350               	#define TWPS0   0
 351               	
 352               	/* MCUCR */
 353               	#define SE      7
 354               	#define SM2     6
 355               	#define SM1     5
 356               	#define SM0     4
 357               	#define ISC11   3
 358               	#define ISC10   2
 359               	#define ISC01   1
 360               	#define ISC00   0
 361               	
 362               	/* MCUCSR */
 363               	#define JTD     7
 364               	#define ISC2    6
 365               	/* bit 5 reserved */
 366               	#define JTRF    4
 367               	#define WDRF    3
 368               	#define BORF    2
 369               	#define EXTRF   1
 370               	#define PORF    0
 371               	
 372               	/* SFIOR */
 373               	#define ADTS2   7
 374               	#define ADTS1   6
 375               	#define ADTS0   5
 376               	/* bit 4 reserved */
 377               	#define ACME    3
 378               	#define PUD     2
 379               	#define PSR2    1
 380               	#define PSR10   0
 381               	
 382               	/* TCCR0 */
 383               	#define FOC0    7
 384               	#define WGM00   6
 385               	#define COM01   5
 386               	#define COM00   4
 387               	#define WGM01   3
 388               	#define CS02    2
 389               	#define CS01    1
 390               	#define CS00    0
 391               	
 392               	/* TCCR2 */
 393               	#define FOC2    7
 394               	#define WGM20   6
 395               	#define COM21   5
 396               	#define COM20   4
 397               	#define WGM21   3
 398               	#define CS22    2
 399               	#define CS21    1
 400               	#define CS20    0
 401               	
 402               	/* ASSR */
 403               	/* bits 7-4 reserved */
 404               	#define AS2     3
 405               	#define TCN2UB  2
 406               	#define OCR2UB  1
 407               	#define TCR2UB  0
 408               	
 409               	/* TCCR1A */
 410               	#define COM1A1  7
 411               	#define COM1A0  6
 412               	#define COM1B1  5
 413               	#define COM1B0  4
 414               	#define FOC1A   3
 415               	#define FOC1B   2
 416               	#define WGM11   1
 417               	#define WGM10   0
 418               	
 419               	/* TCCR1B */
 420               	#define ICNC1   7
 421               	#define ICES1   6
 422               	/* bit 5 reserved */
 423               	#define WGM13   4
 424               	#define WGM12   3
 425               	#define CS12    2
 426               	#define CS11    1
 427               	#define CS10    0
 428               	
 429               	/* WDTCR */
 430               	/* bits 7-5 reserved */
 431               	#define WDTOE   4
 432               	#define WDE     3
 433               	#define WDP2    2
 434               	#define WDP1    1
 435               	#define WDP0    0
 436               	
 437               	/* PA7-PA0 = ADC7-ADC0 */
 438               	/* PORTA */
 439               	#define PA7     7
 440               	#define PA6     6
 441               	#define PA5     5
 442               	#define PA4     4
 443               	#define PA3     3
 444               	#define PA2     2
 445               	#define PA1     1
 446               	#define PA0     0
 447               	
 448               	/* DDRA */
 449               	#define DDA7    7
 450               	#define DDA6    6
 451               	#define DDA5    5
 452               	#define DDA4    4
 453               	#define DDA3    3
 454               	#define DDA2    2
 455               	#define DDA1    1
 456               	#define DDA0    0
 457               	
 458               	/* PINA */
 459               	#define PINA7   7
 460               	#define PINA6   6
 461               	#define PINA5   5
 462               	#define PINA4   4
 463               	#define PINA3   3
 464               	#define PINA2   2
 465               	#define PINA1   1
 466               	#define PINA0   0
 467               	
 468               	/*
 469               	   PB7 = SCK
 470               	   PB6 = MISO
 471               	   PB5 = MOSI
 472               	   PB4 = SS#
 473               	   PB3 = OC0/AIN1
 474               	   PB2 = INT2/AIN0
 475               	   PB1 = T1
 476               	   PB0 = XCK/T0
 477               	 */
 478               	
 479               	/* PORTB */
 480               	#define PB7     7
 481               	#define PB6     6
 482               	#define PB5     5
 483               	#define PB4     4
 484               	#define PB3     3
 485               	#define PB2     2
 486               	#define PB1     1
 487               	#define PB0     0
 488               	
 489               	/* DDRB */
 490               	#define DDB7    7
 491               	#define DDB6    6
 492               	#define DDB5    5
 493               	#define DDB4    4
 494               	#define DDB3    3
 495               	#define DDB2    2
 496               	#define DDB1    1
 497               	#define DDB0    0
 498               	
 499               	/* PINB */
 500               	#define PINB7   7
 501               	#define PINB6   6
 502               	#define PINB5   5
 503               	#define PINB4   4
 504               	#define PINB3   3
 505               	#define PINB2   2
 506               	#define PINB1   1
 507               	#define PINB0   0
 508               	
 509               	/*
 510               	   PC7 = TOSC2
 511               	   PC6 = TOSC1
 512               	   PC1 = SDA
 513               	   PC0 = SCL
 514               	 */
 515               	/* PORTC */
 516               	#define PC7     7
 517               	#define PC6     6
 518               	#define PC5     5
 519               	#define PC4     4
 520               	#define PC3     3
 521               	#define PC2     2
 522               	#define PC1     1
 523               	#define PC0     0
 524               	
 525               	/* DDRC */
 526               	#define DDC7    7
 527               	#define DDC6    6
 528               	#define DDC5    5
 529               	#define DDC4    4
 530               	#define DDC3    3
 531               	#define DDC2    2
 532               	#define DDC1    1
 533               	#define DDC0    0
 534               	
 535               	/* PINC */
 536               	#define PINC7   7
 537               	#define PINC6   6
 538               	#define PINC5   5
 539               	#define PINC4   4
 540               	#define PINC3   3
 541               	#define PINC2   2
 542               	#define PINC1   1
 543               	#define PINC0   0
 544               	
 545               	/*
 546               	   PD7 = OC2
 547               	   PD6 = ICP
 548               	   PD5 = OC1A
 549               	   PD4 = OC1B
 550               	   PD3 = INT1
 551               	   PD2 = INT0
 552               	   PD1 = TXD
 553               	   PD0 = RXD
 554               	 */
 555               	
 556               	/* PORTD */
 557               	#define PD7     7
 558               	#define PD6     6
 559               	#define PD5     5
 560               	#define PD4     4
 561               	#define PD3     3
 562               	#define PD2     2
 563               	#define PD1     1
 564               	#define PD0     0
 565               	
 566               	/* DDRD */
 567               	#define DDD7    7
 568               	#define DDD6    6
 569               	#define DDD5    5
 570               	#define DDD4    4
 571               	#define DDD3    3
 572               	#define DDD2    2
 573               	#define DDD1    1
 574               	#define DDD0    0
 575               	
 576               	/* PIND */
 577               	#define PIND7   7
 578               	#define PIND6   6
 579               	#define PIND5   5
 580               	#define PIND4   4
 581               	#define PIND3   3
 582               	#define PIND2   2
 583               	#define PIND1   1
 584               	#define PIND0   0
 585               	
 586               	/* SPSR */
 587               	#define SPIF    7
 588               	#define WCOL    6
 589               	/* bits 5-1 reserved */
 590               	#define SPI2X   0
 591               	
 592               	/* SPCR */
 593               	#define SPIE    7
 594               	#define SPE     6
 595               	#define DORD    5
 596               	#define MSTR    4
 597               	#define CPOL    3
 598               	#define CPHA    2
 599               	#define SPR1    1
 600               	#define SPR0    0
 601               	
 602               	/* UCSRA */
 603               	#define RXC     7
 604               	#define TXC     6
 605               	#define UDRE    5
 606               	#define FE      4
 607               	#define DOR     3
 608               	#define PE      2
 609               	#define U2X     1
 610               	#define MPCM    0
 611               	
 612               	/* UCSRB */
 613               	#define RXCIE   7
 614               	#define TXCIE   6
 615               	#define UDRIE   5
 616               	#define RXEN    4
 617               	#define TXEN    3
 618               	#define UCSZ2   2
 619               	#define RXB8    1
 620               	#define TXB8    0
 621               	
 622               	/* UCSRC */
 623               	#define URSEL   7
 624               	#define UMSEL   6
 625               	#define UPM1    5
 626               	#define UPM0    4
 627               	#define USBS    3
 628               	#define UCSZ1   2
 629               	#define UCSZ0   1
 630               	#define UCPOL   0
 631               	
 632               	/* ACSR */
 633               	#define ACD     7
 634               	#define ACBG    6
 635               	#define ACO     5
 636               	#define ACI     4
 637               	#define ACIE    3
 638               	#define ACIC    2
 639               	#define ACIS1   1
 640               	#define ACIS0   0
 641               	
 642               	/* ADCSRA */
 643               	#define ADEN    7
 644               	#define ADSC    6
 645               	#define ADATE   5
 646               	#define ADIF    4
 647               	#define ADIE    3
 648               	#define ADPS2   2
 649               	#define ADPS1   1
 650               	#define ADPS0   0
 651               	
 652               	/* ADMUX */
 653               	#define REFS1   7
 654               	#define REFS0   6
 655               	#define ADLAR   5
 656               	#define MUX4    4
 657               	#define MUX3    3
 658               	#define MUX2    2
 659               	#define MUX1    1
 660               	#define MUX0    0
 661               	
 662               	/* EEPROM Control Register */
 663               	#define EERIE   3
 664               	#define EEMWE   2
 665               	#define EEWE    1
 666               	#define EERE    0
 667               	
 668               	/* Constants */
 669               	#define SPM_PAGESIZE 128
 670               	#define RAMSTART    (0x60)
 671               	#define RAMEND      0x85F
 672               	#define XRAMEND     RAMEND
 673               	#define E2END       0x3FF
 674               	#define E2PAGESIZE  4
 675               	#define FLASHEND    0x7FFF
 676               	
 677               	
 678               	/* Fuses */
 679               	
 680               	#define FUSE_MEMORY_SIZE 2
 681               	
 682               	/* Low Fuse Byte */
 683               	#define FUSE_CKSEL0      (unsigned char)~_BV(0)
 684               	#define FUSE_CKSEL1      (unsigned char)~_BV(1)
 685               	#define FUSE_CKSEL2      (unsigned char)~_BV(2)
 686               	#define FUSE_CKSEL3      (unsigned char)~_BV(3)
 687               	#define FUSE_SUT0        (unsigned char)~_BV(4)
 688               	#define FUSE_SUT1        (unsigned char)~_BV(5)
 689               	#define FUSE_BODEN       (unsigned char)~_BV(6)
 690               	#define FUSE_BODLEVEL    (unsigned char)~_BV(7)
 691               	#define LFUSE_DEFAULT (FUSE_CKSEL1 & FUSE_CKSEL2 & FUSE_CKSEL3 & FUSE_SUT0)
 692               	
 693               	/* High Fuse Byte */
 694               	#define FUSE_BOOTRST     (unsigned char)~_BV(0)
 695               	#define FUSE_BOOTSZ0     (unsigned char)~_BV(1)
 696               	#define FUSE_BOOTSZ1     (unsigned char)~_BV(2)
 697               	#define FUSE_EESAVE      (unsigned char)~_BV(3)
 698               	#define FUSE_CKOPT       (unsigned char)~_BV(4)
 699               	#define FUSE_SPIEN       (unsigned char)~_BV(5)
 700               	#define FUSE_JTAGEN      (unsigned char)~_BV(6)
 701               	#define FUSE_OCDEN       (unsigned char)~_BV(7)
 702               	#define HFUSE_DEFAULT (FUSE_BOOTSZ0 & FUSE_BOOTSZ1 & FUSE_SPIEN & FUSE_JTAGEN)
 703               	
 704               	
 705               	/* Lock Bits */
 706               	#define __LOCK_BITS_EXIST
 707               	#define __BOOT_LOCK_BITS_0_EXIST
 708               	#define __BOOT_LOCK_BITS_1_EXIST 
 709               	
 710               	
 711               	/* Signature */
 712               	#define SIGNATURE_0 0x1E
 713               	#define SIGNATURE_1 0x95
 714               	#define SIGNATURE_2 0x02
 715               	
 716               	
 717               	/* Deprecated items */
 718               	#if !defined(__AVR_LIBC_DEPRECATED_ENABLE__)
 719               	
 720               	#pragma GCC system_header
 721               	
 722               	#pragma GCC poison SIG_INTERRUPT0
 723               	#pragma GCC poison SIG_INTERRUPT1
 724               	#pragma GCC poison SIG_INTERRUPT2
 725               	#pragma GCC poison SIG_OUTPUT_COMPARE2
 726               	#pragma GCC poison SIG_OVERFLOW2
 727               	#pragma GCC poison SIG_INPUT_CAPTURE1
 728               	#pragma GCC poison SIG_OUTPUT_COMPARE1A
 729               	#pragma GCC poison SIG_OUTPUT_COMPARE1B
 730               	#pragma GCC poison SIG_OVERFLOW1
 731               	#pragma GCC poison SIG_OUTPUT_COMPARE0
 732               	#pragma GCC poison SIG_OVERFLOW0
 733               	#pragma GCC poison SIG_SPI
 734               	#pragma GCC poison SIG_USART_RECV
 735               	#pragma GCC poison SIG_UART_RECV
 736               	#pragma GCC poison SIG_USART_DATA
 737               	#pragma GCC poison SIG_UART_DATA
 738               	#pragma GCC poison SIG_USART_TRANS
 739               	#pragma GCC poison SIG_UART_TRANS
 740               	#pragma GCC poison SIG_ADC
 741               	#pragma GCC poison SIG_EEPROM_READY
 742               	#pragma GCC poison SIG_COMPARATOR
 743               	#pragma GCC poison SIG_2WIRE_SERIAL
 744               	#pragma GCC poison SIG_SPM_READY
 745               	
 245               	#elif defined (__AVR_ATmega32A__)
 246               	#  include <avr/iom32a.h>
 247               	#elif defined (__AVR_ATmega323__)
 248               	#  include <avr/iom323.h>
 249               	#elif defined (__AVR_ATmega324P__)
 250               	#  include <avr/iom324p.h>
 251               	#elif (defined __AVR_ATmega324A__)
 252               	#include <avr/iom324a.h>
 253               	#elif defined (__AVR_ATmega324PA__)
 254               	#  include <avr/iom324pa.h>
 255               	#elif defined (__AVR_ATmega325__)
 256               	#  include <avr/iom325.h>
 257               	#elif (defined __AVR_ATmega325A__)
 258               	#include <avr/iom325a.h>
 259               	#elif defined (__AVR_ATmega325P__)
 260               	#  include <avr/iom325p.h>
 261               	#elif defined (__AVR_ATmega325PA__)
 262               	#  include <avr/iom325pa.h>  
 263               	#elif defined (__AVR_ATmega3250__) 
 264               	#  include <avr/iom3250.h>
 265               	#elif (defined __AVR_ATmega3250A__)
 266               	#include <avr/iom3250a.h>
 267               	#elif defined (__AVR_ATmega3250P__)
 268               	#  include <avr/iom3250p.h>
 269               	#elif defined (__AVR_ATmega3250PA__)
 270               	#  include <avr/iom3250pa.h>  
 271               	#elif defined (__AVR_ATmega328P__)
 272               	#  include <avr/iom328p.h>
 273               	#elif (defined __AVR_ATmega328__)
 274               	#include <avr/iom328.h>
 275               	#elif defined (__AVR_ATmega329__)
 276               	#  include <avr/iom329.h>
 277               	#elif (defined __AVR_ATmega329A__)
 278               	#include <avr/iom329a.h>
 279               	#elif defined (__AVR_ATmega329P__) 
 280               	#  include <avr/iom329p.h>
 281               	#elif (defined __AVR_ATmega329PA__)
 282               	#include <avr/iom329pa.h>
 283               	#elif (defined __AVR_ATmega3290PA__)
 284               	#include <avr/iom3290pa.h>
 285               	#elif defined (__AVR_ATmega3290__)
 286               	#  include <avr/iom3290.h>
 287               	#elif (defined __AVR_ATmega3290A__)
 288               	#include <avr/iom3290a.h>
 289               	#elif defined (__AVR_ATmega3290P__)
 290               	#  include <avr/iom3290.h>
 291               	#elif defined (__AVR_ATmega32HVB__)
 292               	#  include <avr/iom32hvb.h>
 293               	#elif defined (__AVR_ATmega32HVBREVB__)
 294               	#  include <avr/iom32hvbrevb.h>
 295               	#elif defined (__AVR_ATmega406__)
 296               	#  include <avr/iom406.h>
 297               	#elif defined (__AVR_ATmega16__)
 298               	#  include <avr/iom16.h>
 299               	#elif defined (__AVR_ATmega16A__)
 300               	#  include <avr/iom16a.h>
 301               	#elif defined (__AVR_ATmega161__)
 302               	#  include <avr/iom161.h>
 303               	#elif defined (__AVR_ATmega162__)
 304               	#  include <avr/iom162.h>
 305               	#elif defined (__AVR_ATmega163__)
 306               	#  include <avr/iom163.h>
 307               	#elif defined (__AVR_ATmega164P__)
 308               	#  include <avr/iom164p.h>
 309               	#elif (defined __AVR_ATmega164A__)
 310               	#include <avr/iom164a.h>
 311               	#elif defined (__AVR_ATmega164PA__)
 312               	#  include <avr/iom164pa.h>
 313               	#elif defined (__AVR_ATmega165__)
 314               	#  include <avr/iom165.h>
 315               	#elif (defined __AVR_ATmega165A__)
 316               	#include <avr/iom165a.h>
 317               	#elif defined (__AVR_ATmega165P__)
 318               	#  include <avr/iom165p.h>
 319               	#elif defined (__AVR_ATmega165PA__)
 320               	#  include <avr/iom165pa.h>
 321               	#elif defined (__AVR_ATmega168__)
 322               	#  include <avr/iom168.h>
 323               	#elif (defined __AVR_ATmega168A__)
 324               	#include <avr/iom168a.h>
 325               	#elif defined (__AVR_ATmega168P__)
 326               	#  include <avr/iom168p.h>
 327               	#elif defined (__AVR_ATmega168PA__)
 328               	#  include <avr/iom168pa.h>
 329               	#elif defined (__AVR_ATmega168PB__)
 330               	#  include <avr/iom168pb.h>
 331               	#elif defined (__AVR_ATmega169__)
 332               	#  include <avr/iom169.h>
 333               	#elif (defined __AVR_ATmega169A__)
 334               	#include <avr/iom169a.h>
 335               	#elif defined (__AVR_ATmega169P__)
 336               	#  include <avr/iom169p.h>
 337               	#elif defined (__AVR_ATmega169PA__)
 338               	#  include <avr/iom169pa.h>
 339               	#elif defined (__AVR_ATmega8HVA__)
 340               	#  include <avr/iom8hva.h>
 341               	#elif defined (__AVR_ATmega16HVA__)
 342               	#  include <avr/iom16hva.h>
 343               	#elif defined (__AVR_ATmega16HVA2__)
 344               	#  include <avr/iom16hva2.h>
 345               	#elif defined (__AVR_ATmega16HVB__)
 346               	#  include <avr/iom16hvb.h>
 347               	#elif defined (__AVR_ATmega16HVBREVB__)
 348               	#  include <avr/iom16hvbrevb.h>
 349               	#elif defined (__AVR_ATmega8__)
 350               	#  include <avr/iom8.h>
 351               	#elif defined (__AVR_ATmega8A__)
 352               	#  include <avr/iom8a.h>
 353               	#elif (defined __AVR_ATmega48A__)
 354               	#  include <avr/iom48a.h>
 355               	#elif defined (__AVR_ATmega48__)
 356               	#  include <avr/iom48.h>
 357               	#elif defined (__AVR_ATmega48PA__)
 358               	#  include <avr/iom48pa.h>
 359               	#elif defined (__AVR_ATmega48PB__)
 360               	#  include <avr/iom48pb.h>
 361               	#elif defined (__AVR_ATmega48P__)
 362               	#  include <avr/iom48p.h>
 363               	#elif defined (__AVR_ATmega88__)
 364               	#  include <avr/iom88.h>
 365               	#elif (defined __AVR_ATmega88A__)
 366               	#  include <avr/iom88a.h>
 367               	#elif defined (__AVR_ATmega88P__)
 368               	#  include <avr/iom88p.h>
 369               	#elif defined (__AVR_ATmega88PA__)
 370               	#  include <avr/iom88pa.h>
 371               	#elif defined (__AVR_ATmega88PB__)
 372               	#  include <avr/iom88pb.h>
 373               	#elif defined (__AVR_ATmega8515__)
 374               	#  include <avr/iom8515.h>
 375               	#elif defined (__AVR_ATmega8535__)
 376               	#  include <avr/iom8535.h>
 377               	#elif defined (__AVR_AT90S8535__)
 378               	#  include <avr/io8535.h>
 379               	#elif defined (__AVR_AT90C8534__)
 380               	#  include <avr/io8534.h>
 381               	#elif defined (__AVR_AT90S8515__)
 382               	#  include <avr/io8515.h>
 383               	#elif defined (__AVR_AT90S4434__)
 384               	#  include <avr/io4434.h>
 385               	#elif defined (__AVR_AT90S4433__)
 386               	#  include <avr/io4433.h>
 387               	#elif defined (__AVR_AT90S4414__)
 388               	#  include <avr/io4414.h>
 389               	#elif defined (__AVR_ATtiny22__)
 390               	#  include <avr/iotn22.h>
 391               	#elif defined (__AVR_ATtiny26__)
 392               	#  include <avr/iotn26.h>
 393               	#elif defined (__AVR_AT90S2343__)
 394               	#  include <avr/io2343.h>
 395               	#elif defined (__AVR_AT90S2333__)
 396               	#  include <avr/io2333.h>
 397               	#elif defined (__AVR_AT90S2323__)
 398               	#  include <avr/io2323.h>
 399               	#elif defined (__AVR_AT90S2313__)
 400               	#  include <avr/io2313.h>
 401               	#elif defined (__AVR_ATtiny4__)
 402               	#  include <avr/iotn4.h>
 403               	#elif defined (__AVR_ATtiny5__)
 404               	#  include <avr/iotn5.h>
 405               	#elif defined (__AVR_ATtiny9__)
 406               	#  include <avr/iotn9.h>
 407               	#elif defined (__AVR_ATtiny10__)
 408               	#  include <avr/iotn10.h>
 409               	#elif defined (__AVR_ATtiny20__)
 410               	#  include <avr/iotn20.h>
 411               	#elif defined (__AVR_ATtiny40__)
 412               	#  include <avr/iotn40.h>
 413               	#elif defined (__AVR_ATtiny2313__)
 414               	#  include <avr/iotn2313.h>
 415               	#elif defined (__AVR_ATtiny2313A__)
 416               	#  include <avr/iotn2313a.h>
 417               	#elif defined (__AVR_ATtiny13__)
 418               	#  include <avr/iotn13.h>
 419               	#elif defined (__AVR_ATtiny13A__)
 420               	#  include <avr/iotn13a.h>
 421               	#elif defined (__AVR_ATtiny25__)
 422               	#  include <avr/iotn25.h>
 423               	#elif defined (__AVR_ATtiny4313__)
 424               	#  include <avr/iotn4313.h>
 425               	#elif defined (__AVR_ATtiny45__)
 426               	#  include <avr/iotn45.h>
 427               	#elif defined (__AVR_ATtiny85__)
 428               	#  include <avr/iotn85.h>
 429               	#elif defined (__AVR_ATtiny24__)
 430               	#  include <avr/iotn24.h>
 431               	#elif defined (__AVR_ATtiny24A__)
 432               	#  include <avr/iotn24a.h>
 433               	#elif defined (__AVR_ATtiny44__)
 434               	#  include <avr/iotn44.h>
 435               	#elif defined (__AVR_ATtiny44A__)
 436               	#  include <avr/iotn44a.h>
 437               	#elif defined (__AVR_ATtiny441__)
 438               	#  include <avr/iotn441.h>
 439               	#elif defined (__AVR_ATtiny84__)
 440               	#  include <avr/iotn84.h>
 441               	#elif defined (__AVR_ATtiny84A__)
 442               	#  include <avr/iotn84a.h>  
 443               	#elif defined (__AVR_ATtiny841__)
 444               	#  include <avr/iotn841.h>
 445               	#elif defined (__AVR_ATtiny261__)
 446               	#  include <avr/iotn261.h>
 447               	#elif defined (__AVR_ATtiny261A__)
 448               	#  include <avr/iotn261a.h>
 449               	#elif defined (__AVR_ATtiny461__)
 450               	#  include <avr/iotn461.h>
 451               	#elif defined (__AVR_ATtiny461A__)
 452               	#  include <avr/iotn461a.h>
 453               	#elif defined (__AVR_ATtiny861__)
 454               	#  include <avr/iotn861.h>
 455               	#elif defined (__AVR_ATtiny861A__)
 456               	#  include <avr/iotn861a.h>
 457               	#elif defined (__AVR_ATtiny43U__)
 458               	#  include <avr/iotn43u.h>
 459               	#elif defined (__AVR_ATtiny48__)
 460               	#  include <avr/iotn48.h>
 461               	#elif defined (__AVR_ATtiny88__)
 462               	#  include <avr/iotn88.h>
 463               	#elif defined (__AVR_ATtiny828__)
 464               	#  include <avr/iotn828.h>
 465               	#elif defined (__AVR_ATtiny87__)
 466               	#  include <avr/iotn87.h>
 467               	#elif defined (__AVR_ATtiny167__)
 468               	#  include <avr/iotn167.h>
 469               	#elif defined (__AVR_ATtiny1634__)
 470               	#  include <avr/iotn1634.h>
 471               	#elif defined (__AVR_AT90SCR100__)
 472               	#  include <avr/io90scr100.h>
 473               	#elif defined (__AVR_ATxmega16A4__)
 474               	#  include <avr/iox16a4.h>
 475               	#elif defined (__AVR_ATxmega16A4U__)
 476               	#  include <avr/iox16a4u.h>
 477               	#elif defined (__AVR_ATxmega16C4__)
 478               	#  include <avr/iox16c4.h>
 479               	#elif defined (__AVR_ATxmega16D4__)
 480               	#  include <avr/iox16d4.h>
 481               	#elif defined (__AVR_ATxmega32A4__)
 482               	#  include <avr/iox32a4.h>
 483               	#elif defined (__AVR_ATxmega32A4U__)
 484               	#  include <avr/iox32a4u.h>
 485               	#elif defined (__AVR_ATxmega32C3__)
 486               	#  include <avr/iox32c3.h>
 487               	#elif defined (__AVR_ATxmega32C4__)
 488               	#  include <avr/iox32c4.h>
 489               	#elif defined (__AVR_ATxmega32D3__)
 490               	#  include <avr/iox32d3.h>
 491               	#elif defined (__AVR_ATxmega32D4__)
 492               	#  include <avr/iox32d4.h>
 493               	#elif defined (__AVR_ATxmega8E5__)
 494               	#  include <avr/iox8e5.h>
 495               	#elif defined (__AVR_ATxmega16E5__)
 496               	#  include <avr/iox16e5.h>
 497               	#elif defined (__AVR_ATxmega32E5__)
 498               	#  include <avr/iox32e5.h>
 499               	#elif defined (__AVR_ATxmega64A1__)
 500               	#  include <avr/iox64a1.h>
 501               	#elif defined (__AVR_ATxmega64A1U__)
 502               	#  include <avr/iox64a1u.h>
 503               	#elif defined (__AVR_ATxmega64A3__)
 504               	#  include <avr/iox64a3.h>
 505               	#elif defined (__AVR_ATxmega64A3U__)
 506               	#  include <avr/iox64a3u.h>
 507               	#elif defined (__AVR_ATxmega64A4U__)
 508               	#  include <avr/iox64a4u.h>
 509               	#elif defined (__AVR_ATxmega64B1__)
 510               	#  include <avr/iox64b1.h>
 511               	#elif defined (__AVR_ATxmega64B3__)
 512               	#  include <avr/iox64b3.h>
 513               	#elif defined (__AVR_ATxmega64C3__)
 514               	#  include <avr/iox64c3.h>
 515               	#elif defined (__AVR_ATxmega64D3__)
 516               	#  include <avr/iox64d3.h>
 517               	#elif defined (__AVR_ATxmega64D4__)
 518               	#  include <avr/iox64d4.h>
 519               	#elif defined (__AVR_ATxmega128A1__)
 520               	#  include <avr/iox128a1.h>
 521               	#elif defined (__AVR_ATxmega128A1U__)
 522               	#  include <avr/iox128a1u.h>
 523               	#elif defined (__AVR_ATxmega128A4U__)
 524               	#  include <avr/iox128a4u.h>
 525               	#elif defined (__AVR_ATxmega128A3__)
 526               	#  include <avr/iox128a3.h>
 527               	#elif defined (__AVR_ATxmega128A3U__)
 528               	#  include <avr/iox128a3u.h>
 529               	#elif defined (__AVR_ATxmega128B1__)
 530               	#  include <avr/iox128b1.h>
 531               	#elif defined (__AVR_ATxmega128B3__)
 532               	#  include <avr/iox128b3.h>
 533               	#elif defined (__AVR_ATxmega128C3__)
 534               	#  include <avr/iox128c3.h>
 535               	#elif defined (__AVR_ATxmega128D3__)
 536               	#  include <avr/iox128d3.h>
 537               	#elif defined (__AVR_ATxmega128D4__)
 538               	#  include <avr/iox128d4.h>
 539               	#elif defined (__AVR_ATxmega192A3__)
 540               	#  include <avr/iox192a3.h>
 541               	#elif defined (__AVR_ATxmega192A3U__)
 542               	#  include <avr/iox192a3u.h>
 543               	#elif defined (__AVR_ATxmega192C3__)
 544               	#  include <avr/iox192c3.h>
 545               	#elif defined (__AVR_ATxmega192D3__)
 546               	#  include <avr/iox192d3.h>
 547               	#elif defined (__AVR_ATxmega256A3__)
 548               	#  include <avr/iox256a3.h>
 549               	#elif defined (__AVR_ATxmega256A3U__)
 550               	#  include <avr/iox256a3u.h>
 551               	#elif defined (__AVR_ATxmega256A3B__)
 552               	#  include <avr/iox256a3b.h>
 553               	#elif defined (__AVR_ATxmega256A3BU__)
 554               	#  include <avr/iox256a3bu.h>
 555               	#elif defined (__AVR_ATxmega256C3__)
 556               	#  include <avr/iox256c3.h>
 557               	#elif defined (__AVR_ATxmega256D3__)
 558               	#  include <avr/iox256d3.h>
 559               	#elif defined (__AVR_ATxmega384C3__)
 560               	#  include <avr/iox384c3.h>
 561               	#elif defined (__AVR_ATxmega384D3__)
 562               	#  include <avr/iox384d3.h>
 563               	#elif defined (__AVR_ATA5790__)
 564               	#  include <avr/ioa5790.h>
 565               	#elif defined (__AVR_ATA5790N__)
 566               	#  include <avr/ioa5790n.h>
 567               	#elif defined (__AVR_ATA5791__)
 568               	#  include <avr/ioa5791.h>
 569               	#elif defined (__AVR_ATA5272__)
 570               	#  include <avr/ioa5272.h>
 571               	#elif defined (__AVR_ATA5505__)
 572               	#  include <avr/ioa5505.h>
 573               	#elif defined (__AVR_ATA5795__)
 574               	#  include <avr/ioa5795.h>
 575               	#elif defined (__AVR_ATA5702M322__)
 576               	#  include <avr/ioa5702m322.h>
 577               	#elif defined (__AVR_ATA5782__)
 578               	#  include <avr/ioa5782.h>
 579               	#elif defined (__AVR_ATA8210__)
 580               	#  include <avr/ioa8210.h>
 581               	#elif defined (__AVR_ATA5831__)
 582               	#  include <avr/ioa5831.h>
 583               	#elif defined (__AVR_ATA8510__)
 584               	#  include <avr/ioa8510.h>
 585               	#elif defined (__AVR_ATA6285__)
 586               	#  include <avr/ioa6285.h>
 587               	#elif defined (__AVR_ATA6286__)
 588               	#  include <avr/ioa6286.h>
 589               	#elif defined (__AVR_ATA6289__)
 590               	#  include <avr/ioa6289.h>
 591               	#elif defined (__AVR_ATA6612C__)
 592               	#  include <avr/ioa6612c.h>
 593               	#elif defined (__AVR_ATA6613C__)
 594               	#  include <avr/ioa6613c.h>
 595               	#elif defined (__AVR_ATA6614Q__)
 596               	#  include <avr/ioa6614q.h>
 597               	#elif defined (__AVR_ATA6616C__)
 598               	#  include <avr/ioa6616c.h>
 599               	#elif defined (__AVR_ATA6617C__)
 600               	#  include <avr/ioa6617c.h>
 601               	#elif defined (__AVR_ATA664251__)
 602               	#  include <avr/ioa664251.h>
 603               	/* avr1: the following only supported for assembler programs */
 604               	#elif defined (__AVR_ATtiny28__)
 605               	#  include <avr/iotn28.h>
 606               	#elif defined (__AVR_AT90S1200__)
 607               	#  include <avr/io1200.h>
 608               	#elif defined (__AVR_ATtiny15__)
 609               	#  include <avr/iotn15.h>
 610               	#elif defined (__AVR_ATtiny12__)
 611               	#  include <avr/iotn12.h>
 612               	#elif defined (__AVR_ATtiny11__)
 613               	#  include <avr/iotn11.h>
 614               	#elif defined (__AVR_M3000__)
 615               	#  include <avr/iom3000.h>
 616               	#elif defined (__AVR_DEV_LIB_NAME__)
 617               	#  define __concat__(a,b) a##b
 618               	#  define __header1__(a,b) __concat__(a,b)
 619               	#  define __AVR_DEVICE_HEADER__ <avr/__header1__(io,__AVR_DEV_LIB_NAME__).h>
 620               	#  include __AVR_DEVICE_HEADER__
 621               	#else
 622               	#  if !defined(__COMPILING_AVR_LIBC__)
 623               	#    warning "device type not defined"
 624               	#  endif
 625               	#endif
 626               	
 627               	#include <avr/portpins.h>
   1               	/* Copyright (c) 2003  Theodore A. Roth
 628               	
 629               	#include <avr/common.h>
   1               	/* Copyright (c) 2007 Eric B. Weddington
 630               	
 631               	#include <avr/version.h>
   1               	/* Copyright (c) 2005, Joerg Wunsch                               -*- c -*-
 632               	
 633               	#if __AVR_ARCH__ >= 100
 634               	#  include <avr/xmega.h>
 635               	#endif
 636               	
 637               	/* Include fuse.h after individual IO header files. */
 638               	#include <avr/fuse.h>
   1               	/* Copyright (c) 2007, Atmel Corporation
 639               	
 640               	/* Include lock.h after individual IO header files. */
 641               	#include <avr/lock.h>
   1               	/* Copyright (c) 2007, Atmel Corporation
 642               	
   2               	
   3               	.equ "TWBR", TWBR
   4               	.equ "TWSR", TWSR
   5               	.equ "TWAR", TWAR
   6               	.equ "TWDR", TWDR
   7               	.equ "ADCW", ADCW
   8               	.equ "ADCL", ADCL
   9               	.equ "ADCH", ADCH
  10               	.equ "IOADCH", _SFR_IO_ADDR(ADCH)
  11               	.equ "ADCSRA", ADCSRA
  12               	.equ "IOADCSRA", _SFR_IO_ADDR(ADCSRA)
  13               	.equ "ADMUX", ADMUX
  14               	.equ "ACSR", ACSR
  15               	.equ "UBRRL", UBRRL
  16               	.equ "UCSRB", UCSRB
  17               	.equ "UCSRA", UCSRA
  18               	.equ "UDR", UDR
  19               	.equ "SPCR", SPCR
  20               	.equ "SPSR", SPSR
  21               	.equ "SPDR", SPDR
  22               	.equ "PIND", PIND
  23               	.equ "DDRD", DDRD
  24               	.equ "PORTD", PORTD
  25               	.equ "PINC", PINC
  26               	.equ "DDRC", DDRC
  27               	.equ "PORTC", PORTC
  28               	.equ "PINB", PINB
  29               	.equ "DDRB", DDRB
  30               	.equ "PORTB", PORTB
  31               	.equ "PINA", PINA
  32               	.equ "DDRA", DDRA
  33               	.equ "IODDRA", _SFR_IO_ADDR(DDRA)
  34               	.equ "PORTA", PORTA
  35               	.equ "EECR", EECR
  36               	.equ "EEDR", EEDR
  37               	.equ "EEAR", EEAR
  38               	.equ "EEARL", EEARL
  39               	.equ "EEARH", EEARH
  40               	.equ "UBRRH", UBRRH
  41               	.equ "UCSRC", UCSRC
  42               	.equ "WDTCR", WDTCR
  43               	.equ "ASSR", ASSR
  44               	.equ "SFIOR", SFIOR
  45               	.equ "OSCCAL", OSCCAL
  46               	.equ "OCDR", OCDR
  47               	#ifdef MCUSR
  48               	.equ "MCUSR", MCUSR
  49               	.equ "MCUSR", _SFR_IO_ADDR(MCUSR)
  50               	#endif
  51               	.equ "MCUCSR", MCUCSR
  52               	.equ "MCUCR", MCUCR
  53               	.equ "TWCR", TWCR
  54               	.equ "SPMCR", SPMCR
  55               	.equ "TIFR", TIFR
  56               	#ifdef TIMSK
  57               	.equ "TIMSK", TIMSK
  58               	.equ "IOTIMSK", _SFR_IO_ADDR(TIMSK)
  59               	#endif
  60               	.equ "GIFR", GIFR
  61               	#ifdef GIMSK
  62               	.equ "GIMSK", GIMSK
  63               	.equ "IOGIMSK", _SFR_IO_ADDR(GIMSK)
  64               	#endif
  65               	
  66               	.equ "GICR", GICR
  67               	.equ "_VECTORS_SIZE", _VECTORS_SIZE
  68               	.equ "IVSEL", IVSEL
  69               	.equ "IVCE", IVCE
  70               	.equ "SPMIE", SPMIE
  71               	.equ "RWWSB", RWWSB
  72               	.equ "RWWSRE", RWWSRE
  73               	.equ "BLBSET", BLBSET
  74               	.equ "PGWRT", PGWRT
  75               	.equ "PGERS", PGERS
  76               	.equ "SPMEN", SPMEN
  77               	.equ "TWINT", TWINT
  78               	.equ "TWEA", TWEA
  79               	.equ "TWSTA", TWSTA
  80               	.equ "TWSTO", TWSTO
  81               	.equ "TWWC", TWWC
  82               	.equ "TWEN", TWEN
  83               	.equ "TWIE", TWIE
  84               	.equ "TWGCE", TWGCE
  85               	.equ "SE", SE
  86               	.equ "JTD", JTD
  87               	.equ "JTRF", JTRF
  88               	.equ "WDRF", WDRF
  89               	.equ "BORF", BORF
  90               	.equ "EXTRF", EXTRF
  91               	.equ "PORF", PORF
  92               	.equ "ACME", ACME
  93               	.equ "PUD", PUD
  94               	.equ "WDTOE", WDTOE
  95               	.equ "WDE", WDE
  96               	.equ "SPIF", SPIF
  97               	.equ "WCOL", WCOL
  98               	.equ "SPIE", SPIE
  99               	.equ "SPE", SPE
 100               	.equ "DORD", DORD
 101               	.equ "MSTR", MSTR
 102               	.equ "CPOL", CPOL
 103               	.equ "CPHA", CPHA
 104               	.equ "RXC", RXC
 105               	.equ "TXC", TXC
 106               	.equ "UDRE", UDRE
 107               	.equ "FE", FE
 108               	.equ "DOR", DOR
 109               	.equ "PE", PE
 110               	.equ "MPCM", MPCM
 111               	.equ "RXCIE", RXCIE
 112               	.equ "TXCIE", TXCIE
 113               	.equ "UDRIE", UDRIE
 114               	.equ "RXEN", RXEN
 115               	.equ "TXEN", TXEN
 116               	.equ "URSEL", URSEL
 117               	.equ "UMSEL", UMSEL
 118               	.equ "USBS", USBS
 119               	.equ "UCPOL", UCPOL
 120               	.equ "ACD", ACD
 121               	.equ "ACBG", ACBG
 122               	.equ "ACO", ACO
 123               	.equ "ACI", ACI
 124               	.equ "ACIE", ACIE
 125               	.equ "ACIC", ACIC
 126               	.equ "ADEN", ADEN
 127               	.equ "ADSC", ADSC
 128               	.equ "ADATE", ADATE
 129               	.equ "ADIF", ADIF
 130               	.equ "ADIE", ADIE
 131               	.equ "ADLAR", ADLAR
 132               	.equ "EERIE", EERIE
 133               	.equ "EEMWE", EEMWE
 134               	.equ "EEWE", EEWE
 135               	.equ "EERE", EERE
 136               	.equ "SPM_PAGESIZE", SPM_PAGESIZE
 137               	.equ "RAMSTART", RAMSTART
 138               	.equ "RAMEND", RAMEND
 139               	.equ "XRAMEND", XRAMEND
 140               	.equ "FLASHEND", FLASHEND
 141               	.equ "FUSE_MEMORY_SIZE", FUSE_MEMORY_SIZE
 142               	.equ "TCCR2", TCCR2
 143               	.equ "TCNT2", TCNT2
 144               	#ifdef SREG
 145               	.equ "SREG", SREG
 146               	.equ "IOSREG", _SFR_IO_ADDR(SREG)
 147               	#endif
 148               	
 149               	.equ "IOSPL", _SFR_IO_ADDR(SPL)
 150               	.equ "IOSPH", _SFR_IO_ADDR(SPH)
 151               	.equ "IOPORTD", _SFR_IO_ADDR(PORTD)
 152               	.equ "IOPORTB", _SFR_IO_ADDR(PORTB)
 153               	.equ "IOPORTC", _SFR_IO_ADDR(PORTC)
 154               	.equ "IOPORTA", _SFR_IO_ADDR(PORTA)
 155               	.equ "IOPINB", _SFR_IO_ADDR(PINB)
 156               	.equ "IODDRD", _SFR_IO_ADDR(DDRD)
 157               	.equ "IODDRB", _SFR_IO_ADDR(DDRB)
 158               	.equ "IOADMUX", _SFR_IO_ADDR(ADMUX)
 159               	.equ "IOADCSRA", _SFR_IO_ADDR(ADCSRA)
 160               	.equ "IOTCCR2", _SFR_IO_ADDR(TCCR2)
 161               	.equ "IOTCNT2", _SFR_IO_ADDR(TCNT2)
 162               	.equ "IOOCR2", _SFR_IO_ADDR(OCR2)
 163               	
 164               	; bits for TCCR2 atmega32
 165               	.equ "FOC2", 7
 166               	.equ "WGM20", 6
 167               	.equ "COM21", 5
 168               	.equ "COM20", 4
 169               	.equ "WGM21", 3
 170               	.equ "CS22", 2
 171               	.equ "CS21", 1
 172               	.equ "CS20", 0
 173               	; bits for APCSRA atmega32
 174               	.equ "ADEN", 7
 175               	.equ "ADSC", 6
 176               	.equ "ADATE", 5
 177               	.equ "ADIF", 4
 178               	.equ "ADIE", 3
 179               	.equ "ADPS2", 2
 180               	.equ "ADPS1", 1
 181               	.equ "ADPS0", 0
 182               	
 183               	.equ R0, 0
 184               	.equ R1, 1 
 185               	.equ R2, 2 
 186               	.equ R3, 3 
 187               	.equ R4, 4 
 188               	.equ R5, 5 
 189               	.equ R6, 6 
 190               	.equ R7, 7 
 191               	.equ R8, 8 
 192               	.equ R9, 9 
 193               	.equ R10, 10
 194               	.equ R11, 11 
 195               	.equ R12, 12 
 196               	.equ R13, 13 
 197               	.equ R14, 14 
 198               	.equ R15, 15 
 199               	.equ R16, 16 
 200               	.equ R17, 17 
 201               	.equ R18, 18 
 202               	.equ R19, 19 
 203               	.equ R20, 20
 204               	.equ R21, 21 
 205               	.equ R22, 22 
 206               	.equ R23, 23 
 207               	.equ R24, 24 
 208               	.equ R25, 25 
 209               	.equ R26, 26 
 210               	.equ R27, 27 
 211               	.equ R28, 28 
 212               	.equ R29, 29 
 213               	.equ R30, 30
 214               	.equ R31, 31
  27               	.include "rtos.inc"
   1               	.global RT_ClearTimers
   2               	.global RT_ClearTaskQueue
   3               	.global RT_ProcessTaskQueue
   4               	.global RT_Start
   5               	.global RT_TimerInterrupt
   6               	.global RT_Init
   7               	.global RT_SendTask
   8               	.global RT_SetTimer
   9               	.global RT_TaskProcs
  10               	.equ RT_TaskQueueSize, 11
  11               	.equ RT_TimersPoolSize, 5
  12               	.equ RT_TimerDivider, 8000000/64/1000 	; 1 mS
  13               	.equ RT_RG, R17
  14               	.macro RT_TIMER taskno, ms
  15               		ldi 	RT_RG, \taskno
  16               		ldi 	XL, lo8(\ms)
  17               		ldi 	XH, hi8(\ms)
  18               		rcall 	RT_SetTimer
  19               	.endm
  20               	.macro RT_TASK taskno, ms
  21               		ldi RT_RG, \taskno
  22               		rcall RT_SendTask
  23               	.endm
  24               	
  25               	;SRAM STS analog for Tiny
  26               	/*
  27               				.macro	LDR reg, addr
  28               				push	ZL
  29               				push	ZH
  30               	
  31               				ldi		ZL,lo8(\addr)
  32               				ldi		ZH,hi8(\addr)
  33               	
  34               				ld		\reg, Z
  35               	
  36               				pop		ZH
  37               				pop		ZL
  38               				.endm
  39               	
  40               	
  41               	
  42               				.macro	STR reg, addr
  43               				push	ZL
  44               				push	ZH
  45               	
  46               				ldi		ZL,lo8(\addr)
  47               				ldi		ZH,hi8(\addr)
  48               	
  49               				st		Z, \reg
  50               	
  51               				pop		ZH
  52               				pop		ZL
  53               				.endm
  54               	
  55               	;=======================================================================================
  56               	;FLASH
  57               				.macro	LDF reg, addr
  58               				push	ZL
  59               				push	ZH
  60               	
  61               				ldi		ZL, lo8(\addr*2)
  62               				ldi		ZH, hi8(\addr*2)
  63               	
  64               				lpm		\reg, Z
  65               	
  66               				pop		ZH
  67               				pop		ZL
  68               				.endm
  69               	
  70               				.macro	LDPA addr
  71               				ldi		ZL, lo8(\addr*2)
  72               				ldi		ZH, hi8(\addr*2)
  73               				.endm
  74               	;========================================================================================
  75               	;XYZ
  76               				.macro	LDX addr
  77               				ldi		XL, lo8(\addr)
  78               				ldi		XH, hi8(\addr)
  79               				.endm
  80               	
  81               				.macro	LDY addr
  82               				ldi		YL, lo8(\addr)
  83               				ldi		YH, hi8(\addr)
  84               				.endm
  85               	
  86               				.macro	LDZ addr
  87               				ldi		ZL, lo8(\addr)
  88               				ldi		ZH, hi8(\addr)
  89               				.endm
  90               	
  91               	;========================================================================================
  92               	;USART INIT
  93               	
  94               	
  95               				.macro	USART_INIT
  96               	
  97               				.equ XTAL 			, MainClock
  98               				.equ baudrate 		, 19200
  99               				.equ bauddivider 	, XTAL/(16*baudrate)-1
 100               	
 101               				
 102               				OUTI 	UBRRL, lo8(bauddivider)
 103               				OUTI 	UBRRH, hi8(bauddivider)
 104               				OUTI 	UCSRA, 0
 105               				OUTI 	UCSRB, (1<<RXEN)|(1<<TXEN)|(1<<RXCIE)|(1<<TXCIE)
 106               				OUTI 	UCSRC, (1<<URSEL)|(1<<UCSZ0)|(1<<UCSZ1)
 107               				.endm
 108               	*/
  28               	.equ Counter , R16				;  (  
  29               	#.equ OSRG , R17
  30               	.equ Tmp2 , R18					;
  31               	.equ Tmp3 , R19					;
  32               	.equ Tmp4 , R20					;    
  33               	.section .data
  34               	
  35               	RT_TaskQueue:
  36 0000 0000 0000 		.skip RT_TaskQueueSize
  36      0000 0000 
  36      0000 00
  37               	RT_TimersPool:
  38 000b 0000 0000 		.skip RT_TimersPoolSize*3
  38      0000 0000 
  38      0000 0000 
  38      0000 00
  39               	
  40               	.section .text
  41               	RT_Init:
  42:rtos.s        **** 		rcall RT_ClearTimers		;    
  43:rtos.s        **** 		rcall RT_ClearTaskQueue	;    
  44               	
  45               			; Init Timer 2
  46               			;     
  47               	
  48:rtos.s        **** 		ldi RT_RG,1<<WGM21|4<<CS20	; Freq = CK/64 -    
  49:rtos.s        **** 		out IOTCCR2, RT_RG				;     
  50               	
  51:rtos.s        **** 		clr RT_RG					;    
  52:rtos.s        **** 		out IOTCNT2, RT_RG				;	
  53               	
  54:rtos.s        **** 		ldi RT_RG, lo8(RT_TimerDivider)
  55:rtos.s        **** 		out IOOCR2, RT_RG				;     
  56:rtos.s        **** 		ldi RT_RG, 1<<7 
  57:rtos.s        **** 		out IOTIMSK, RT_RG
  58:rtos.s        **** 		sei						;   
  59:rtos.s        **** 		ret
  60               	
  61               	RT_Start:
  62               	
  63               			# wdr
  64:rtos.s        **** 		rcall RT_ProcessTaskQueue
  65:rtos.s        **** 		rjmp RT_Start
  66               	
  67               	RT_TimerInterrupt:
  68:rtos.s        **** 			push 	RT_RG
  69:rtos.s        **** 			in 		RT_RG, IOSREG		; Save Sreg
  70:rtos.s        **** 			push 	RT_RG				;   RT_RG   
  71               	
  72:rtos.s        **** 			push 	ZL	
  73:rtos.s        **** 			push 	ZH					;   Z
  74:rtos.s        **** 			push 	Counter				;   Counter
  75               		
  76:rtos.s        **** 			ldi 	ZL, lo8(RT_TimersPool)	;    Z  RAM, 
  77:rtos.s        **** 			ldi 	ZH, hi8(RT_TimersPool) ;      
  78               	
  79:rtos.s        **** 			ldi 	Counter, RT_TimersPoolSize ;   
  80               		
  81:rtos.s        **** .LComp1L01:	ld 		RT_RG, Z				; RT_RG = [Z] ;   
  82:rtos.s        **** 			cpi 	RT_RG, 0xFF			;   "NOP"
  83:rtos.s        **** 			breq 	.LComp1L03			;  NOP     
  84               	
  85:rtos.s        **** 			clt							;  T    
  86:rtos.s        **** 			ldd 	RT_RG, Z+1			; 
  87:rtos.s        **** 			subi 	RT_RG, lo8(1) 		;      1
  88:rtos.s        **** 			std 	Z+1, RT_RG			;
  89:rtos.s        **** 			breq 	.LComp1L02			;  0   T  
  90:rtos.s        **** 			set							; 
  91               	
  92:rtos.s        **** .LComp1L02:	ldd 	RT_RG, Z+2			;
  93:rtos.s        **** 			sbci 	RT_RG, hi8(1) 		;      1
  94:rtos.s        **** 			std 	Z+2, RT_RG			;
  95:rtos.s        **** 			brne 	.LComp1L03			;   
  96:rtos.s        **** 			brts 	.LComp1L03			;    ( T)	
  97               		
  98:rtos.s        **** 			ld 		RT_RG, Z				;   
  99:rtos.s        **** 			rcall 	RT_SendTask			;     
 100               		
 101:rtos.s        **** 			ldi 	RT_RG, 0xFF			; = NOP ( ,  
 102:rtos.s        **** 			st 		Z, RT_RG				; Clear Event
 103               	
 104:rtos.s        **** .LComp1L03:	subi 	ZL, lo8(-3)			; Skip Counter
 105:rtos.s        **** 			sbci 	ZH, hi8(-3)			; Z+=3 -    
 106:rtos.s        **** 			dec 	Counter				;  
 107:rtos.s        **** 			brne 	.LComp1L01			; Loop	
 108               	
 109:rtos.s        **** 			pop 	Counter				;  
 110:rtos.s        **** 			pop 	ZH
 111:rtos.s        **** 			pop 	ZL
 112               	
 113:rtos.s        **** 			pop 	RT_RG				;  
 114:rtos.s        **** 			out 	IOSREG, RT_RG			; 
 115:rtos.s        **** 			pop 	RT_RG
 116:rtos.s        **** 			reti
 117               	
 118               	
 119               	RT_ClearTaskQueue:
 120:rtos.s        **** 		push 	ZL
 121:rtos.s        **** 		push 	ZH
 122               	
 123:rtos.s        **** 		ldi 	ZL, lo8(RT_TaskQueue)
 124:rtos.s        **** 		ldi 	ZH, hi8(RT_TaskQueue)
 125               	
 126:rtos.s        **** 		ldi 	RT_RG, 0xFF		
 127:rtos.s        **** 		ldi 	Counter, RT_TaskQueueSize
 128               	
 129               	.LCEQL01: 
 130:rtos.s        **** 		st 		Z+, RT_RG		;
 131:rtos.s        **** 		dec 	Counter		;
 132:rtos.s        **** 		brne 	.LCEQL01		; Loop
 133               	
 134:rtos.s        **** 		pop 	ZH
 135:rtos.s        **** 		pop 	ZL
 136:rtos.s        **** 		ret
 137               		
 138               	RT_ClearTimers:
 139:rtos.s        **** 		push 	ZL
 140:rtos.s        **** 		push 	ZH
 141               	
 142:rtos.s        **** 		ldi 	ZL, lo8(RT_TimersPool)
 143:rtos.s        **** 		ldi 	ZH, hi8(RT_TimersPool)
 144               	
 145:rtos.s        **** 		ldi 	Counter, RT_TimersPoolSize
 146:rtos.s        **** 		ldi 	RT_RG, 0xFF		; Empty 
 147:rtos.s        **** 		ldi 	Tmp2, 0x00
 148               	
 149               	.LCTL01:	
 150:rtos.s        **** 		st 		Z+, RT_RG		; Event
 151:rtos.s        **** 		st 		Z+, Tmp2		; Counter Lo
 152:rtos.s        **** 		st 		Z+, Tmp2		; Counter Hi
 153               	
 154:rtos.s        **** 		dec 	Counter		;
 155:rtos.s        **** 		brne 	.LCTL01		; Loop
 156               		
 157:rtos.s        **** 		pop 	ZH
 158:rtos.s        **** 		pop 	ZL
 159:rtos.s        **** 		ret	
 160               	;------------------------------------------------------------------------------
 161               	
 162               	
 163               	
 164               	
 165               	RT_ProcessTaskQueue:
 166:rtos.s        **** 		ldi 	ZL, lo8(RT_TaskQueue)
 167:rtos.s        **** 		ldi 	ZH, hi8(RT_TaskQueue)
 168               	
 169:rtos.s        **** 		ld 		RT_RG, Z		; For Event
 170:rtos.s        **** 		cpi 	RT_RG, 0xFF	; No Event or Addr out of Range
 171:rtos.s        **** 		breq 	.LPTQL02		; No Action
 172               		
 173:rtos.s        **** 		clr 	ZH
 174:rtos.s        **** 		lsl 	RT_RG
 175:rtos.s        **** 		mov 	ZL, RT_RG
 176               	
 177               			
 178:rtos.s        **** 		ldi 	RT_RG, lo8(RT_TaskProcs)
 179:rtos.s        **** 		add 	ZL, RT_RG
 180:rtos.s        **** 		ldi		RT_RG, hi8(RT_TaskProcs)
 181:rtos.s        **** 		adc		ZH, RT_RG 
 182               	
 183:rtos.s        **** 		lpm					; mov r0 <- CODE[Z]
 184:rtos.s        **** 		mov 	RT_RG, r0
 185:rtos.s        **** 		ld 		r0, Z+			; inc Z
 186:rtos.s        **** 		lpm	
 187:rtos.s        **** 		mov 	ZL, RT_RG		; Get Addr
 188:rtos.s        **** 		mov 	ZH, r0
 189               		
 190:rtos.s        **** 		push 	ZL
 191:rtos.s        **** 		push 	ZH
 192               	
 193               	; Advance Queue
 194:rtos.s        **** 		ldi 	Counter, RT_TaskQueueSize-1
 195:rtos.s        **** 		ldi 	ZL, lo8(RT_TaskQueue)
 196:rtos.s        **** 		ldi 	ZH, hi8(RT_TaskQueue)
 197               		
 198:rtos.s        **** 		cli
 199               		
 200               	.LPTQL01:	
 201:rtos.s        **** 		ldd 	RT_RG, Z+1 		;	Shift Queues
 202:rtos.s        **** 		st 		Z+, RT_RG		
 203               	
 204:rtos.s        **** 		dec 	Counter		
 205:rtos.s        **** 		brne 	.LPTQL01		; Loop
 206:rtos.s        **** 		ldi 	RT_RG, 0xFF	
 207:rtos.s        **** 		st 		Z+, RT_RG		
 208               		
 209:rtos.s        **** 		sei
 210               	
 211:rtos.s        **** 		pop 	ZH
 212:rtos.s        **** 		pop 	ZL
 213:rtos.s        **** 		clc
 214:rtos.s        **** 		ror ZH
 215:rtos.s        **** 		ror ZL
 216:rtos.s        **** 		clc
 217:rtos.s        **** 		ijmp 			; Minimize Stack Usage
 218               		
 219               	.LPTQL02:	
 220:rtos.s        **** 		ret	
 221               	
 222               	
 223               	;-------------------------------------------------------------------------
 224               	; RT_RG - Event
 225               	RT_SendTask:
 226:rtos.s        **** 		push 	ZL
 227:rtos.s        **** 		push 	ZH
 228:rtos.s        **** 		push 	Tmp2
 229:rtos.s        **** 		push 	Counter
 230               	
 231:rtos.s        **** 		ldi 	ZL,lo8(RT_TaskQueue)
 232:rtos.s        **** 		ldi 	ZH,hi8(RT_TaskQueue)
 233               	
 234:rtos.s        **** 		ldi 	Counter, RT_TaskQueueSize
 235               	
 236               	.LSEQL01: 
 237:rtos.s        **** 		ld 		Tmp2, Z+
 238               	
 239:rtos.s        **** 		cpi 	Tmp2, 0xFF
 240:rtos.s        **** 		breq 	.LSEQL02
 241               	
 242:rtos.s        **** 		dec 	Counter		;
 243:rtos.s        **** 		breq 	.LSEQL03		; Loop
 244:rtos.s        **** 		rjmp 	.LSEQL01
 245               	
 246               	.LSEQL02: 
 247:rtos.s        **** 		st 		-Z, RT_RG	; Store Task
 248               	
 249               	
 250               	
 251               	.LSEQL03:					; EXIT
 252:rtos.s        **** 		pop 	Counter
 253:rtos.s        **** 		pop 	Tmp2
 254:rtos.s        **** 		pop 	ZH
 255:rtos.s        **** 		pop 	ZL
 256:rtos.s        **** 		ret	
 257               	;------------------------------------------------------------------------	
 258               	; RT_RG - Timer Event
 259               	; X - Counter
 260               	RT_SetTimer:
 261:rtos.s        **** 		push 	ZL
 262:rtos.s        **** 		push 	ZH
 263:rtos.s        **** 		push 	Tmp2
 264:rtos.s        **** 		push 	Counter
 265               	
 266:rtos.s        **** 		ldi 	ZL, lo8(RT_TimersPool)
 267:rtos.s        **** 		ldi 	ZH, hi8(RT_TimersPool)
 268               	
 269:rtos.s        **** 		ldi 	Counter, RT_TimersPoolSize
 270               		
 271               	.LSTL01: 
 272:rtos.s        **** 		ld 		Tmp2, Z		; Value / Counter
 273:rtos.s        **** 		cp 		Tmp2, RT_RG		; Search for Event
 274:rtos.s        **** 		breq 	.LSTL02
 275               		
 276:rtos.s        **** 		subi 	ZL, lo8(-3)	; Skip Counter
 277:rtos.s        **** 		sbci 	ZH, hi8(-3)	; Z+=2
 278               	
 279:rtos.s        **** 		dec 	Counter		;
 280:rtos.s        **** 		breq 	.LSTL03		; Loop
 281:rtos.s        **** 		rjmp 	.LSTL01
 282               		
 283               	.LSTL02:	;cli
 284:rtos.s        **** 		std 	Z+1, XL		; Critical Section
 285:rtos.s        **** 		std 	Z+2, XH		; Update Counter
 286               			;sei				; leave Critical Section
 287:rtos.s        **** 		rjmp	.LSTL06		; Exit
 288               	.LSTL03:
 289               	
 290:rtos.s        **** 		ldi 	ZL, lo8(RT_TimersPool)
 291:rtos.s        **** 		ldi 	ZH, hi8(RT_TimersPool)
 292               	
 293:rtos.s        **** 		ldi 	Counter, RT_TimersPoolSize
 294               		
 295               	.LSTL04:	
 296:rtos.s        **** 		ld 		Tmp2, Z		; Value / Counter
 297:rtos.s        **** 		cpi 	Tmp2, 0xFF		; Search for Empty Timer
 298:rtos.s        **** 		breq 	.LSTL05
 299               		
 300:rtos.s        **** 		subi 	ZL, lo8(-3)	; Skip Counter
 301:rtos.s        **** 		sbci 	ZH, hi8(-3)	; Z+=2
 302               	
 303:rtos.s        **** 		dec 	Counter		;
 304:rtos.s        **** 		breq 	.LSTL06		; No Empty Timer
 305:rtos.s        **** 		rjmp 	.LSTL04
 306               		
 307               	.LSTL05:	
 308:rtos.s        **** 		cli
 309:rtos.s        **** 		st 		Z, RT_RG		; Set Event 
 310:rtos.s        **** 		std 	Z+1, XL
 311:rtos.s        **** 		std 	Z+2, XH
 312:rtos.s        **** 		sei
 313               	
 314               	.LSTL06:
 315:rtos.s        **** 		pop 	Counter
 316:rtos.s        **** 		pop 	Tmp2
 317:rtos.s        **** 		pop 	ZH
 318:rtos.s        **** 		pop 	ZL
 319:rtos.s        **** 		ret
 320               	.end
DEFINED SYMBOLS
              rtos.s:138    .text:0000000000000080 RT_ClearTimers
              rtos.s:119    .text:0000000000000068 RT_ClearTaskQueue
              rtos.s:165    .text:000000000000009e RT_ProcessTaskQueue
              rtos.s:61     .text:0000000000000018 RT_Start
              rtos.s:67     .text:000000000000001c RT_TimerInterrupt
              rtos.s:41     .text:0000000000000000 RT_Init
              rtos.s:225    .text:00000000000000ec RT_SendTask
              rtos.s:260    .text:0000000000000112 RT_SetTimer
              rtos.s:35     .data:0000000000000000 RT_TaskQueue
              rtos.s:37     .data:000000000000000b RT_TimersPool

UNDEFINED SYMBOLS
RT_TaskProcs
